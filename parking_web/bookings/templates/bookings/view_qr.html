{% extends 'base.html' %}

{% block title %}View QR Code - Smart Parking{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white text-center">
                    <h4>Your Parking QR Code</h4>
                </div>
                <div class="card-body text-center">
                    {% if expired %}
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i>
                        <strong>Booking Expired!</strong><br>
                        You did not check in within 30 minutes. Payment has been forfeited.
                    </div>
                    {% else %}
                    <div class="mb-3">
                        <h5>{{ booking.ticket_number }}</h5>
                        <p class="text-muted">{{ booking.slot.floor }} - {{ booking.slot.section }} - {{ booking.slot.slot_number }}</p>
                    </div>
                    
                    {% if booking.qr_code_path %}
                    <div class="qr-code-container mb-3">
                        <img src="/media/{{ booking.qr_code_path }}" alt="QR Code" class="img-fluid" style="max-width: 300px;">
                    </div>
                    {% endif %}
                    
                    {% if booking.booking_status == 'pending' %}
                    <div class="alert alert-warning">
                        <i class="bi bi-clock-history"></i>
                        <strong>Check in within {{ time_remaining }} minutes</strong><br>
                        Scan this QR code at the entry gate to check in
                    </div>
                    {% elif booking.booking_status == 'active' %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        <strong>Checked In</strong><br>
                        Scan at exit gate when leaving
                    </div>
                    {% endif %}
                    
                    <div class="mt-3">
                        <a href="{% url 'bookings:dashboard' %}" class="btn btn-primary">Back to Dashboard</a>
                        <a href="{% url 'bookings:my_bookings' %}" class="btn btn-outline-secondary">My Bookings</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-body">
                    <h6>Booking Details</h6>
                    <p class="mb-1"><strong>Vehicle:</strong> {{ booking.vehicle.vehicle_number }}</p>
                    <p class="mb-1"><strong>Duration:</strong> {{ booking.duration_hours }} hour(s)</p>
                    <p class="mb-1"><strong>Amount Paid:</strong> â‚¹{{ booking.total_price }}</p>
                    <p class="mb-1"><strong>Booking Time:</strong> {{ booking.booking_time }}</p>
                    {% if booking.booking_status == 'pending' %}
                    <p class="mb-1"><strong>Check-in Deadline:</strong> {{ booking.checkin_deadline }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% if booking.booking_status == 'pending' and not expired %}
<script>
// Auto-refresh every minute to update time remaining
setTimeout(function() {
    location.reload();
}, 60000);
</script>
{% endif %}
{% endblock %}
